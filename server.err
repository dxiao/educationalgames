TypeError: Cannot call method 'toJson' of undefined
  at /Users/dxiao/EducationalGames/teamer/server.coffee:231:43
  at callbacks (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:164:37)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:138:11)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:135:11)
  at pass (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:145:5)
  at Router._dispatch (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:173:5)
  at Object.router (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:33:10)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at multipart (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/multipart.js:97:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:64:9
  at urlencoded (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/urlencoded.js:41:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:62:7
  at json (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/json.js:42:37)
  at Object.bodyParser [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:60:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.logger (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/logger.js:158:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.expressInit [as handle] (/Users/dxiao/EducationalGames/node_modules/express/lib/middleware.js:30:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.query [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/query.js:45:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Function.app.handle (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:201:3)
  at Server.app (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/connect.js:65:37)
  at Server.EventEmitter.emit (events.js:98:17)
  at HTTPParser.parser.onIncoming (http.js:2108:12)
  at HTTPParser.parserOnHeadersComplete [as onHeadersComplete] (http.js:121:23)
  at Socket.socket.ondata (http.js:1966:22)
  at TCP.onread (net.js:525:27)

TypeError: Cannot call method 'toJson' of undefined
  at /Users/dxiao/EducationalGames/teamer/server.coffee:231:43
  at callbacks (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:164:37)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:138:11)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:135:11)
  at pass (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:145:5)
  at Router._dispatch (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:173:5)
  at Object.router (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:33:10)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at multipart (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/multipart.js:97:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:64:9
  at urlencoded (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/urlencoded.js:41:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:62:7
  at json (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/json.js:42:37)
  at Object.bodyParser [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:60:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.logger (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/logger.js:158:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.expressInit [as handle] (/Users/dxiao/EducationalGames/node_modules/express/lib/middleware.js:30:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.query [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/query.js:45:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Function.app.handle (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:201:3)
  at Server.app (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/connect.js:65:37)
  at Server.EventEmitter.emit (events.js:98:17)
  at HTTPParser.parser.onIncoming (http.js:2108:12)
  at HTTPParser.parserOnHeadersComplete [as onHeadersComplete] (http.js:121:23)
  at Socket.socket.ondata (http.js:1966:22)
  at TCP.onread (net.js:525:27)

TypeError: Cannot call method 'toJson' of undefined
  at /Users/dxiao/EducationalGames/teamer/server.coffee:231:43
  at callbacks (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:164:37)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:138:11)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:135:11)
  at pass (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:145:5)
  at Router._dispatch (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:173:5)
  at Object.router (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:33:10)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at multipart (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/multipart.js:97:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:64:9
  at urlencoded (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/urlencoded.js:41:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:62:7
  at json (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/json.js:42:37)
  at Object.bodyParser [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:60:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.logger (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/logger.js:158:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.expressInit [as handle] (/Users/dxiao/EducationalGames/node_modules/express/lib/middleware.js:30:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.query [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/query.js:45:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Function.app.handle (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:201:3)
  at Server.app (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/connect.js:65:37)
  at Server.EventEmitter.emit (events.js:98:17)
  at HTTPParser.parser.onIncoming (http.js:2108:12)
  at HTTPParser.parserOnHeadersComplete [as onHeadersComplete] (http.js:121:23)
  at Socket.socket.ondata (http.js:1966:22)
  at TCP.onread (net.js:525:27)

TypeError: Cannot call method 'toJson' of undefined
  at /Users/dxiao/EducationalGames/teamer/server.coffee:231:43
  at callbacks (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:164:37)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:138:11)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:135:11)
  at pass (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:145:5)
  at Router._dispatch (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:173:5)
  at Object.router (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:33:10)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at multipart (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/multipart.js:97:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:64:9
  at urlencoded (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/urlencoded.js:41:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:62:7
  at json (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/json.js:42:37)
  at Object.bodyParser [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:60:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.logger (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/logger.js:158:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.expressInit [as handle] (/Users/dxiao/EducationalGames/node_modules/express/lib/middleware.js:30:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.query [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/query.js:45:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Function.app.handle (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:201:3)
  at Server.app (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/connect.js:65:37)
  at Server.EventEmitter.emit (events.js:98:17)
  at HTTPParser.parser.onIncoming (http.js:2108:12)
  at HTTPParser.parserOnHeadersComplete [as onHeadersComplete] (http.js:121:23)
  at Socket.socket.ondata (http.js:1966:22)
  at TCP.onread (net.js:525:27)

TypeError: Cannot call method 'toJson' of undefined
  at /Users/dxiao/EducationalGames/teamer/server.coffee:231:43
  at callbacks (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:164:37)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:138:11)
  at param (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:135:11)
  at pass (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:145:5)
  at Router._dispatch (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:173:5)
  at Object.router (/Users/dxiao/EducationalGames/node_modules/express/lib/router/index.js:33:10)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:168:78)
  at multipart (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/multipart.js:97:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:64:9
  at urlencoded (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/urlencoded.js:41:37)
  at /Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:62:7
  at json (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/json.js:42:37)
  at Object.bodyParser [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:60:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.logger (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/logger.js:158:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.expressInit [as handle] (/Users/dxiao/EducationalGames/node_modules/express/lib/middleware.js:30:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Object.query [as handle] (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/middleware/query.js:45:5)
  at next (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:193:15)
  at Function.app.handle (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/proto.js:201:3)
  at Server.app (/Users/dxiao/EducationalGames/node_modules/express/node_modules/connect/lib/connect.js:65:37)
  at Server.EventEmitter.emit (events.js:98:17)
  at HTTPParser.parser.onIncoming (http.js:2108:12)
  at HTTPParser.parserOnHeadersComplete [as onHeadersComplete] (http.js:121:23)
  at Socket.socket.ondata (http.js:1966:22)
  at TCP.onread (net.js:525:27)


